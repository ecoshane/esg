<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ°¸çºŒæ•¸æ“š AI è½‰æ›å¹³å° - Ecoshane (è™›æ“¬å°ˆæ¡ˆ)</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&family=Noto+Sans+TC:wght@400;700;900&display=swap" rel="stylesheet">
    <style>
        /* çµ±ä¸€å“ç‰Œè‰²ç³» */
        :root { 
            /* å“ç‰Œä¸»è‰² (æ·±è—) */
            --brand-primary: #0A1C3B;       
            --brand-secondary: #11367D;     
            
            /* åŠŸèƒ½èªæ„è‰² */
            --semantic-env: #059669;        /* ç’°å¢ƒ (ç¶ ) */
            --semantic-risk: #b91c1c;       /* é¢¨éšª (ç´…) */
            --semantic-sroi: #2563eb;       /* SROI (è—) */
            --warning-yellow: #f59e0b; 
        }
        
        body { 
            font-family: 'Inter', 'Noto Sans TC', sans-serif; 
            background-color: #f3f4f6; 
        }
        
        /* å¹³å°æ¨™é ­ - ä½¿ç”¨å“ç‰Œä¸»è‰² */
        .platform-header { 
            background-color: var(--brand-primary); 
            color: white; 
            padding: 1.5rem 2rem; 
            border-radius: 0.5rem; 
            box-shadow: 0 6px 10px rgba(0,0,0,0.2); 
            margin-bottom: 1.5rem;
        }

        /* æ¨™ç±¤é æ¨£å¼ */
        .tabs-container {
            display: flex;
            overflow-x: auto; 
            gap: 0.5rem;
            border-bottom: 2px solid #e5e7eb;
            margin-bottom: 0;
        }
        .tab-button {
            padding: 0.75rem 1.5rem;
            font-size: 1rem;
            font-weight: 700;
            color: #6b7280;
            transition: all 0.3s ease;
            cursor: pointer;
            border-bottom: 4px solid transparent;
            border-radius: 0.5rem 0.5rem 0 0;
            background-color: transparent;
            white-space: nowrap;
        }
        .tab-button:hover {
            background-color: #e5e7eb;
        }
        .tab-button.active {
            background-color: white;
            border-bottom-color: var(--brand-primary); 
            color: var(--brand-primary);
        }
        /* å€‹åˆ¥æ¨¡çµ„é¡è‰² */
        .tab-button[data-tab="dashboard"].active { border-bottom-color: var(--brand-secondary); color: var(--brand-secondary); }
        .tab-button[data-tab="env"].active { border-bottom-color: var(--semantic-env); color: var(--semantic-env); }
        .tab-button[data-tab="hrdd"].active { border-bottom-color: var(--semantic-risk); color: var(--semantic-risk); }
        .tab-button[data-tab="sroi"].active { border-bottom-color: var(--semantic-sroi); color: var(--semantic-sroi); }

        /* å…§å®¹å¡ç‰‡ */
        .content-card {
            background-color: white;
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
            padding: 2rem;
            border-radius: 0 0 0.5rem 0.5rem; 
            display: none;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        .content-card.active {
            display: block;
            opacity: 1;
        }

        /* å„€è¡¨æ¿çµ„ä»¶æ¨£å¼ (å·²çµ±ä¸€é¡è‰²) */
        .kpi-card { 
            background-color: white; 
            border-radius: 0.75rem; 
            border: 1px solid #e5e7eb; 
            box-shadow: 0 2px 4px rgba(0,0,0,0.05); 
            padding: 1.5rem; 
            height: 100%; 
            display: flex; 
            flex-direction: column; 
            transition: transform 0.3s ease; 
            position: relative;
            overflow: hidden;
        }
        /* çµ±ä¸€ä½¿ç”¨å“ç‰Œæ¬¡è¦è‰²ä½œç‚ºå´é‚Šè£é£¾æ¢ */
        .kpi-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 4px;
            height: 100%;
            background-color: var(--brand-secondary); 
        }

        .kpi-card:hover { transform: translateY(-3px); box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1); }
        
        .kpi-title { font-size: 0.875rem; font-weight: 600; color: #6b7280; margin-bottom: 0.5rem; display: flex; justify-content: space-between; align-items: center; padding-left: 0.5rem; }
        .kpi-value { font-size: 2.25rem; font-weight: 800; color: #1f2937; line-height: 1.1; padding-left: 0.5rem; } 
        .kpi-change { font-size: 0.875rem; font-weight: 600; margin-top: 0.25rem; display: flex; align-items: center; padding-left: 0.5rem; }
        
        /* æ–‡å­—é¡è‰²ä¿ç•™åŠŸèƒ½èªæ„ */
        .text-positive { color: var(--semantic-env); } 
        .text-negative { color: var(--semantic-risk); } 
        .text-warning { color: var(--warning-yellow); }

        /* SVG åœ–è¡¨æ¨£å¼ */
        .chart-container { 
            background-color: #ffffff; 
            border-radius: 0.75rem; 
            padding: 1.5rem; 
            height: 300px; 
            position: relative; 
            overflow: hidden; 
            border: 1px solid #e5e7eb; 
            box-shadow: inset 0 0 20px rgba(0,0,0,0.02);
        }
        .chart-svg {
            width: 100%;
            height: 100%;
            overflow: visible;
        }
        .chart-line-path {
            fill: none;
            stroke-width: 4;
            stroke-linecap: round;
            stroke-linejoin: round;
            filter: drop-shadow(0 4px 6px rgba(0,0,0,0.1));
            transition: d 1s ease;
        }
        .chart-area-path {
            stroke: none;
            opacity: 0.2;
            transition: d 1s ease;
        }
        .chart-dot {
            fill: white;
            stroke-width: 3;
            r: 6;
            transition: cy 1s ease, cx 1s ease;
            cursor: pointer;
        }
        .chart-dot:hover {
            r: 9;
        }
        /* ç¶²æ ¼ç·š */
        .chart-grid line {
            stroke: #f3f4f6;
            stroke-width: 1;
        }
        .chart-axis-text {
            font-size: 12px;
            fill: #9ca3af;
        }

        /* å„ªåŒ–ç‰ˆè­¦ç¤ºåˆ—è¡¨ */
        .alert-card {
            display: flex;
            align-items: start;
            padding: 1rem;
            margin-bottom: 0.75rem;
            background: white;
            border-radius: 0.5rem;
            border-left: 4px solid transparent;
            box-shadow: 0 1px 3px rgba(0,0,0,0.05);
            transition: all 0.2s;
            cursor: pointer;
        }
        .alert-card:hover {
            transform: translateX(4px);
            box-shadow: 0 4px 6px -1px rgba(0,0,0,0.1);
        }
        .alert-card.high-risk {
            border-left-color: var(--semantic-risk);
            background: #fff5f5;
        }
        .alert-card.medium-risk {
            border-left-color: var(--warning-yellow);
            background: #fffbeb;
        }
        .alert-card.low-risk {
            border-left-color: var(--semantic-env);
            background: #f0fdf4;
        }
        .alert-icon {
            flex-shrink: 0;
            width: 2.5rem;
            height: 2.5rem;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 1rem;
        }
        .alert-content h4 { font-weight: 700; color: #374151; font-size: 0.95rem; margin-bottom: 0.25rem; }
        .alert-content p { font-size: 0.8rem; color: #6b7280; line-height: 1.4; }
        .alert-meta { font-size: 0.75rem; color: #9ca3af; margin-top: 0.5rem; display: flex; align-items: center; gap: 0.5rem; }

        /* è¡¨æ ¼ */
        .table-header { background-color: #f3f4f6; font-weight: 700; color: #374151; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 0.05em; }
        .table td, .table th { padding: 0.75rem 1rem; border-bottom: 1px solid #e5e7eb; }
        .risk-badge { padding: 0.25rem 0.5rem; border-radius: 9999px; font-size: 0.75rem; font-weight: 700; display: inline-block; }
        .risk-badge.high { background-color: #fee2e2; color: #991b1b; }
        .risk-badge.med { background-color: #fef3c7; color: #92400e; }
        .risk-badge.low { background-color: #d1fae5; color: #065f46; }
        
        /* é€²åº¦æ¢æ¨£å¼ */
        .progress-container {
            width: 100%;
            background-color: #e5e7eb;
            border-radius: 9999px;
            overflow: hidden;
            height: 0.75rem;
            margin-top: 1rem;
            display: none; 
        }
        .progress-bar {
            height: 100%;
            width: 0%;
            background-color: var(--semantic-sroi);
            transition: width 0.3s ease;
            background-image: linear-gradient(45deg,rgba(255,255,255,.15) 25%,transparent 25%,transparent 50%,rgba(255,255,255,.15) 50%,rgba(255,255,255,.15) 75%,transparent 75%,transparent);
            background-size: 1rem 1rem;
            animation: progress-stripe 1s linear infinite;
        }
        @keyframes progress-stripe {
            from { background-position: 1rem 0; }
            to { background-position: 0 0; }
        }

        /* é¢¨éšªå¡ç‰‡ */
        .signal-card {
            border: 1px solid #e5e7eb;
            border-radius: 0.5rem;
            padding: 1rem;
            margin-bottom: 1rem;
            background-color: #f9fafb;
            transition: all 0.3s ease;
            animation: fadeIn 0.5s ease;
        }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .signal-card.verified {
            border-color: var(--semantic-risk);
            background-color: #fef2f2;
        }
        .signal-card.dismissed {
            opacity: 0.5;
            background-color: #f3f4f6;
            text-decoration: line-through;
        }

        /* æª”æ¡ˆä¸Šå‚³å›é¥‹ (å·²ä¸Šå‚³ç‹€æ…‹) */
        .file-input-group.uploaded .form-input {
            border-color: var(--semantic-env);
            background-color: #f0fdf4;
            color: #166534;
            pointer-events: none; /* æ¨¡æ“¬å·²é–å®š */
        }
        .file-feedback {
            font-size: 0.875rem;
            color: var(--semantic-env);
            margin-top: 0.5rem;
            display: none; /* JSæ§åˆ¶ */
            align-items: center;
            font-weight: 600;
        }

        /* æŒ‰éˆ•æ¨£å¼ */
        .btn { padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 700; transition: all 0.3s ease; display: inline-flex; align-items: center; justify-content: center; cursor: pointer; }
        .btn-env { background-color: var(--semantic-env); color: white; }
        .btn-env:hover { background-color: #047857; }
        .btn-danger { background-color: var(--semantic-risk); color: white; }
        .btn-danger:hover { background-color: #991b1b; }
        .btn-blue { background-color: var(--semantic-sroi); color: white; }
        .btn-blue:hover { background-color: #1e40af; }
        
        .form-input { width: 100%; border: 1px solid #d1d5db; border-radius: 0.375rem; padding: 0.75rem 1rem; transition: border-color 0.3s; }
        .form-input:focus { outline: none; border-color: var(--brand-secondary); box-shadow: 0 0 0 2px rgba(17, 54, 125, 0.2); }
        .form-label { font-weight: 600; color: #374151; margin-bottom: 0.5rem; display: block; }

        /* èŠå¤©æ©Ÿå™¨äºº */
        #chat-toggle {
            position: fixed;
            bottom: 25px;
            right: 25px;
            background: var(--brand-primary);
            color: white;
            border: none;
            border-radius: 50%;
            width: 65px;
            height: 65px;
            font-size: 26px;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            z-index: 1001;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: transform 0.3s;
        }
        #chat-toggle:hover { transform: scale(1.1); }
        
        #chat-window {
            position: fixed;
            bottom: 100px;
            right: 25px;
            width: 340px;
            height: 480px;
            border-radius: 16px;
            background: white;
            display: none;
            flex-direction: column;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.2);
            z-index: 1001;
            overflow: hidden;
            border: 1px solid #eee;
        }
        #chat-window.show { display: flex; animation: slideUp 0.3s ease; }
        
        #chat-header {
            background: var(--brand-primary);
            color: white;
            padding: 15px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        #chat-messages {
            flex: 1;
            padding: 15px;
            overflow-y: auto;
            background: #f9fafb;
            display: flex;
            flex-direction: column;
            gap: 12px;
        }
        .message {
            padding: 10px 14px;
            border-radius: 12px;
            max-width: 85%;
            font-size: 0.9rem;
            line-height: 1.5;
        }
        .message.user {
            background: var(--brand-secondary);
            color: white;
            align-self: flex-end;
            border-bottom-right-radius: 2px;
        }
        .message.bot {
            background: white;
            color: #333;
            align-self: flex-start;
            border-bottom-left-radius: 2px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            border: 1px solid #eee;
        }
        .quick-replies {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 5px;
        }
        .quick-btn {
            background: #e0f2fe;
            color: #0369a1;
            border: 1px solid #bae6fd;
            padding: 6px 12px;
            border-radius: 15px;
            font-size: 0.75rem;
            cursor: pointer;
            transition: all 0.2s;
            font-weight: 600;
        }
        .quick-btn:hover {
            background: #0284c7;
            color: white;
        }
        #chat-input-container {
            padding: 15px;
            border-top: 1px solid #eee;
            display: flex;
            background: white;
            gap: 10px;
        }
        #chat-input {
            flex: 1;
            padding: 10px 15px;
            border: 1px solid #ddd;
            border-radius: 25px;
            outline: none;
            font-size: 0.9rem;
        }
        #chat-send {
            background: var(--brand-primary);
            color: white;
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

    </style>
</head>
<body class="p-4 md:p-8 min-h-screen flex flex-col">

    <!-- é ‚éƒ¨å…è²¬è²æ˜ -->
    <div class="bg-gray-800 text-gray-400 text-xs text-center py-2 rounded-t-md mb-0">
        å…è²¬è²æ˜ï¼šæœ¬å¹³å°ç‚º Ecoshane æ°¸çºŒå®¶ä¹‹è™›æ“¬å°ˆæ¡ˆæ¼”ç¤ºä»‹é¢ï¼Œæ‰€æœ‰æ•¸æ“šèˆ‡å®¢æˆ¶åç¨±å‡ç‚ºè™›æ§‹ï¼Œåƒ…ä¾›æ•™è‚²ç”¨é€”ã€‚
    </div>

    <header class="platform-header flex flex-col md:flex-row justify-between items-center mt-0 rounded-t-none">
        <div class="mb-4 md:mb-0">
            <h1 class="text-2xl font-bold flex items-center">
                <i class="fas fa-chart-line mr-3 text-blue-300"></i>
                æ°¸çºŒæ•¸æ“š AI è½‰æ›å¹³å°
            </h1>
            <p class="text-sm opacity-80 mt-1">Ecoshane æ°¸çºŒå®¶ - æ•¸æ“šåˆ†æå¸«å·¥ä½œç«™</p>
        </div>
        <div class="flex items-center bg-white/10 p-2 rounded-lg">
            <label for="client-select" class="text-sm font-medium text-gray-300 mr-3">ç•¶å‰å®¢æˆ¶:</label>
            <select id="client-select" class="bg-gray-800 text-white font-semibold rounded-md py-2 px-4 focus:outline-none border border-gray-600">
                <option value="yingying">ç›ˆç›ˆæ°´æ³¥é›†åœ˜ (æ°´æ³¥æ¥­)</option>
                <option value="grandwheel">å®è¼ªè‡ªè¡Œè»Šé›†åœ˜ (è£½é€ æ¥­)</option>
                <option value="tech_a">å…‰è¯é›»å­ (é›»å­æ¥­)</option>
            </select>
        </div>
    </header>

    <div class="bg-white rounded-lg shadow-lg overflow-hidden flex-1">
        <!-- æ¨™ç±¤å°èˆª -->
        <nav class="tabs-container px-4 pt-4 bg-gray-50">
            <button class="tab-button active" data-tab="dashboard">
                <i class="fas fa-tachometer-alt mr-2"></i> ç¸½è¦½å„€è¡¨æ¿
            </button>
            <button class="tab-button" data-tab="env">
                <i class="fas fa-leaf mr-2"></i> ç’°å¢ƒç¸¾æ•ˆ (E)
            </button>
            <button class="tab-button" data-tab="hrdd">
                <i class="fas fa-shield-alt mr-2"></i> HRDD é¢¨éšª (S-)
            </button>
            <button class="tab-button" data-tab="sroi">
                <i class="fas fa-hand-holding-heart mr-2"></i> SROI åƒ¹å€¼ (S+)
            </button>
        </nav>

        <main>
            <!-- ================= 1. ç¸½è¦½å„€è¡¨æ¿ (Dashboard) ================= -->
            <div id="dashboard-content" class="content-card active" data-content="dashboard">
                <div class="flex justify-between items-center mb-6">
                    <h2 class="text-2xl font-bold text-gray-800">å®¢æˆ¶é¢¨éšªæ¦‚æ³ç¸½è¦½</h2>
                    <span class="text-sm text-gray-500"><i class="fas fa-sync-alt mr-1"></i> æ•¸æ“šå¯¦æ™‚æ›´æ–°</span>
                </div>

                <!-- KPI å¡ç‰‡ -->
                <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8">
                    <div class="kpi-card risk">
                        <div class="kpi-title"><span>HRDD é¢¨éšªåˆ†æ•¸</span><i class="fas fa-shield-alt text-gray-400"></i></div>
                        <div class="kpi-value" id="dash-risk-score">45<span class="text-lg font-semibold text-gray-400">/100</span></div>
                        <div class="kpi-change" id="dash-risk-change"><i class="fas fa-arrow-down mr-1"></i> -33.8%</div>
                        <p class="text-xs text-gray-500 mt-auto pt-2" id="dash-risk-desc">é¢¨éšªæ”¹å–„é¡¯è‘—ï¼ŒæŒçºŒç›£æ¸¬ä¸­ã€‚</p>
                    </div>
                    <div class="kpi-card warning">
                        <div class="kpi-title"><span>å¾…è™•ç†ç´…ç‡ˆè­¦ç¤º</span><i class="fas fa-flag text-gray-400"></i></div>
                        <div class="kpi-value" id="dash-red-flags">0 <span class="text-lg font-semibold text-gray-400">ä»¶</span></div>
                        <div class="kpi-change" id="dash-flags-change"><i class="fas fa-minus mr-1"></i> æŒå¹³</div>
                        <p class="text-xs text-gray-500 mt-auto pt-2">ç›®å‰ç„¡é‡å¤§é•è¦äº‹ä»¶ã€‚</p>
                    </div>
                    <div class="kpi-card success">
                        <div class="kpi-title"><span>SLL ç’°å¢ƒç¸¾æ•ˆ (E)</span><i class="fas fa-leaf text-gray-400"></i></div>
                        <div class="kpi-value" id="dash-env-score">92<span class="text-lg font-semibold text-gray-400">%</span></div>
                        <div class="kpi-change" id="dash-env-change"><i class="fas fa-arrow-up mr-1"></i> +1.5%</div>
                        <p class="text-xs text-gray-500 mt-auto pt-2">ç’°å¢ƒæ‰¿è«¾ç©©å®šå…Œç¾ã€‚</p>
                    </div>
                    <div class="kpi-card value">
                        <div class="kpi-title"><span>SROI ç¤¾æœƒå›å ± (S+)</span><i class="fas fa-hand-holding-heart text-gray-400"></i></div>
                        <div class="kpi-value" id="dash-sroi-ratio">1:3.4</div>
                        <div class="kpi-change" id="dash-sroi-change"><i class="fas fa-arrow-up mr-1"></i> +0.3</div>
                        <p class="text-xs text-gray-500 mt-auto pt-2">ç¤¾æœƒåƒ¹å€¼å‰µé€ å„ªæ–¼é æœŸã€‚</p>
                    </div>
                </section>

                <!-- åœ–è¡¨èˆ‡è­¦ç¤º -->
                <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                    <div class="lg:col-span-2">
                        <h3 class="text-lg font-bold text-gray-800 mb-3">é¢¨éšªåˆ†æ•¸è¶¨å‹¢</h3>
                        <div class="chart-container">
                            <svg class="chart-svg" viewBox="0 0 600 250" preserveAspectRatio="none">
                                <!-- ç¶²æ ¼ -->
                                <g class="chart-grid">
                                    <line x1="0" y1="50" x2="600" y2="50" />
                                    <line x1="0" y1="100" x2="600" y2="100" />
                                    <line x1="0" y1="150" x2="600" y2="150" />
                                    <line x1="0" y1="200" x2="600" y2="200" />
                                </g>
                                <!-- Yè»¸æ¨™ç±¤ -->
                                <text x="10" y="20" class="chart-axis-text">100</text>
                                <text x="10" y="240" class="chart-axis-text">0</text>
                                <!-- å‹•æ…‹è·¯å¾‘ (Area & Line) -->
                                <path id="chart-area" class="chart-area-path" />
                                <path id="chart-line" class="chart-line-path" />
                                <!-- äº’å‹•é» (ç”± JS ç”Ÿæˆ) -->
                                <g id="chart-dots"></g>
                            </svg>
                        </div>
                    </div>
                    <div class="lg:col-span-1">
                        <h3 class="text-lg font-bold text-gray-800 mb-3 flex items-center"><i class="fas fa-bell text-red-600 mr-2"></i> å³æ™‚é¢¨éšªè­¦å ±</h3>
                        <div class="bg-gray-50 p-3 rounded-lg border border-gray-200 h-[300px] overflow-y-auto" id="dashboard-alerts">
                            <!-- è­¦ç¤ºé …ç›®ç”± JS ç”Ÿæˆ -->
                        </div>
                    </div>
                </section>

                <!-- å®¢æˆ¶åˆ—è¡¨è¡¨æ ¼ (Portfolio View) -->
                <section>
                    <h3 class="text-lg font-bold text-gray-800 mb-3">æŠ•è³‡çµ„åˆæ¦‚è¦½</h3>
                    <div class="overflow-x-auto rounded-lg border border-gray-200">
                        <table class="table w-full text-sm text-left">
                            <thead class="table-header">
                                <tr>
                                    <th>å®¢æˆ¶åç¨±</th>
                                    <th>ç”¢æ¥­</th>
                                    <th>é¢¨éšª (S-)</th>
                                    <th>ç’°å¢ƒ (E)</th>
                                    <th>SROI (S+)</th>
                                    <th>SLL ç‹€æ…‹</th>
                                </tr>
                            </thead>
                            <tbody class="bg-white" id="portfolio-table">
                                <!-- è¡¨æ ¼å…§å®¹ç”± JS ç”Ÿæˆ -->
                            </tbody>
                        </table>
                    </div>
                </section>
            </div>

            <!-- ================= 2. ç’°å¢ƒ (E) å…§å®¹ ================= -->
            <div id="env-content" class="content-card" data-content="env">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">ç’°å¢ƒæ•¸æ“šè‡ªå‹•åŒ–ä»‹æ¥</h2>
                <p class="text-gray-600 mb-6">ç³»çµ±å°‡è‡ªå‹•æ¯”å°ä¸Šå‚³ä¹‹ç¢ºä¿¡å ±å‘Šèˆ‡ API å¯¦æ™‚æ•¸æ“šï¼Œè¨ˆç®— SPTs (æ°¸çºŒç¸¾æ•ˆç›®æ¨™) é”æˆç‡ã€‚</p>
                
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- å·¦å´ï¼šä¸Šå‚³å€ -->
                    <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                            <i class="fas fa-file-upload mr-2 text-green-600"></i> ISO 14064-1 æŸ¥è­‰å ±å‘Šä¸Šå‚³
                        </h3>
                        <div class="space-y-6">
                            <!-- ISO æ–‡ä»¶ -->
                            <div class="file-input-group" id="file-group-iso">
                                <label class="form-label">é¸æ“‡å¹´åº¦æº«å®¤æ°£é«”ç›¤æŸ¥å ±å‘Šæ›¸ (.pdf)</label>
                                <div class="relative">
                                    <input type="text" class="form-input bg-white cursor-pointer" readonly placeholder="é»æ“Šé¸æ“‡æª”æ¡ˆ..." value="">
                                    <div class="absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 pointer-events-none">
                                        <i class="fas fa-folder-open"></i>
                                    </div>
                                </div>
                                <div class="file-feedback">
                                    <i class="fas fa-check-circle mr-1"></i> <span class="filename"></span> - è§£ææˆåŠŸ
                                </div>
                            </div>
                            
                            <!-- é›»è²»å–® -->
                            <div class="file-input-group" id="file-group-power">
                                <label class="form-label">é¸æ“‡å°é›»/ç¶ é›»æ†‘è­‰ (.csv, .xlsx)</label>
                                <div class="relative">
                                    <input type="text" class="form-input bg-white cursor-pointer" readonly placeholder="é»æ“Šé¸æ“‡æª”æ¡ˆ..." value="">
                                    <div class="absolute inset-y-0 right-0 flex items-center px-3 text-gray-500 pointer-events-none">
                                        <i class="fas fa-folder-open"></i>
                                    </div>
                                </div>
                                <div class="file-feedback">
                                    <i class="fas fa-check-circle mr-1"></i> <span class="filename"></span> - è§£ææˆåŠŸ
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <!-- å³å´ï¼šAPI ç‹€æ…‹ -->
                    <div class="bg-gray-50 p-6 rounded-lg border border-gray-200">
                        <h3 class="text-lg font-semibold text-gray-700 mb-4 flex items-center">
                            <i class="fas fa-network-wired mr-2 text-blue-600"></i> å³æ™‚æ•¸æ“š API ç‹€æ…‹
                        </h3>
                        <div class="space-y-3">
                            <div class="flex items-center justify-between p-3 bg-white rounded border border-gray-200 shadow-sm">
                                <div>
                                    <div class="font-bold text-gray-700">EMS èƒ½æºç®¡ç†ç³»çµ±</div>
                                    <div class="text-xs text-green-600 flex items-center mt-1">
                                        <span class="w-2 h-2 bg-green-500 rounded-full mr-1 animate-pulse"></span> é€£ç·šæ­£å¸¸ (Ping: 12ms)
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-gray-800">1,240 <span class="text-sm font-normal">kWh</span></div>
                                    <div class="text-xs text-gray-500">ä»Šæ—¥ç”¨é›»</div>
                                </div>
                            </div>
                            <div class="flex items-center justify-between p-3 bg-white rounded border border-gray-200 shadow-sm">
                                <div>
                                    <div class="font-bold text-gray-700">ç¢³æ’è¨ˆç®—å¼•æ“ (Scope 1+2)</div>
                                    <div class="text-xs text-gray-500 mt-1">
                                        ä¸Šæ¬¡åŒæ­¥: 10 åˆ†é˜å‰
                                    </div>
                                </div>
                                <div class="text-right">
                                    <div class="text-2xl font-bold text-gray-800">0.48 <span class="text-sm font-normal">tCO2e</span></div>
                                    <div class="text-xs text-gray-500">ä»Šæ—¥ç´¯è¨ˆ</div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- é‹ç®—å€ -->
                <div class="mt-8 pt-6 border-t border-gray-200">
                    <button class="btn btn-env w-full md:w-auto text-lg px-8 process-btn" data-type="env">
                        <i class="fas fa-calculator mr-2"></i> é–‹å§‹ SPTs é”æˆç‡é‹ç®—
                    </button>
                    
                    <!-- é€²åº¦æ¢ -->
                    <div class="progress-container" id="env-progress">
                        <div class="progress-bar bg-green-600" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-500 mt-2 hidden log-text" id="env-log">æ­£åœ¨åˆå§‹åŒ–ç’°å¢ƒæ•¸æ“šæ¨¡å‹...</p>

                    <!-- çµæœ (ç”± JS å‹•æ…‹ç”Ÿæˆ) -->
                    <div id="env-result" class="hidden mt-6 p-6 rounded-lg animate-fade-in border">
                        <!-- Content injected by JS -->
                    </div>
                </div>
            </div>

            <!-- ================= 3. HRDD (S-) å…§å®¹ ================= -->
            <div id="hrdd-content" class="content-card" data-content="hrdd">
                <div class="flex justify-between items-end mb-4">
                    <div>
                        <h2 class="text-2xl font-bold text-gray-800">HRDD é¢¨éšª AI ç›£æ§</h2>
                        <p class="text-gray-600">AI è‡ªå‹•æŠ“å–å…¨çƒæ–°èèˆ‡ NGO å ±å‘Šï¼Œè«‹åˆ†æå¸«å”åŠ©é©—è­‰ä»¥ä¸‹é¢¨éšªè¨Šè™Ÿ (Signals)ã€‚</p>
                    </div>
                    <div class="text-right">
                        <div class="text-sm text-gray-500">ç›®å‰é¢¨éšªè©•ç´š</div>
                        <div id="risk-score-display" class="text-3xl font-bold text-green-600">ä½é¢¨éšª</div>
                    </div>
                </div>
                
                <div class="bg-white border border-gray-200 rounded-lg overflow-hidden mb-6">
                    <div class="bg-gray-100 px-4 py-2 border-b border-gray-200 flex justify-between items-center">
                        <span class="font-semibold text-gray-700"><i class="fas fa-bell mr-2"></i> å¾…é©—è­‰è¨Šè™Ÿ</span>
                        <span class="text-xs bg-blue-100 text-blue-800 px-2 py-1 rounded">AI 24H ç›£æ¸¬ä¸­</span>
                    </div>
                    
                    <div class="p-4 space-y-4" id="risk-list">
                        <!-- JS å‹•æ…‹æ’å…¥ -->
                    </div>
                </div>

                <!-- HRDD é‹ç®—å€ -->
                <div class="pt-6 border-t border-gray-200">
                    <button class="btn btn-danger w-full md:w-auto text-lg px-8 process-btn" data-type="hrdd">
                        <i class="fas fa-file-contract mr-2"></i> ç”Ÿæˆ HRDD åˆè¦å ±å‘Š
                    </button>
                    
                    <div class="progress-container" id="hrdd-progress">
                        <div class="progress-bar bg-red-600" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-500 mt-2 hidden log-text" id="hrdd-log">æ­£åœ¨å½™æ•´é¢¨éšªæ•¸æ“š...</p>

                    <!-- çµæœ -->
                    <div id="hrdd-result" class="hidden mt-6 p-6 bg-red-50 border border-red-200 rounded-lg animate-fade-in">
                        <h3 class="text-xl font-bold text-red-800 mb-2"><i class="fas fa-exclamation-circle mr-2"></i>é¢¨éšªè©•ä¼°å ±å‘Šç”Ÿæˆå®Œç•¢</h3>
                        <p class="text-red-700 mb-4">ç³»çµ±åµæ¸¬åˆ° <span id="verified-count">0</span> å€‹å·²é©—è­‰çš„é«˜é¢¨éšªäº‹ä»¶ã€‚å»ºè­°ç«‹å³å•Ÿå‹•ä¾›æ‡‰éˆç¨½æ ¸ç¨‹åº (CAP)ã€‚</p>
                        <button class="bg-white border border-red-300 text-red-700 px-4 py-2 rounded shadow-sm hover:bg-red-50">
                            ä¸‹è¼‰ PDF å ±å‘Š
                        </button>
                    </div>
                </div>
            </div>

            <!-- ================= 4. SROI (S+) å…§å®¹ ================= -->
            <div id="sroi-content" class="content-card" data-content="sroi">
                <h2 class="text-2xl font-bold text-gray-800 mb-2">SROI ç¤¾æœƒåƒ¹å€¼è©¦ç®—</h2>
                <p class="text-gray-600 mb-6">è¼¸å…¥å°ˆæ¡ˆè²¡å‹™èˆ‡éè²¡å‹™æŠ•å…¥ï¼Œå³æ™‚é ä¼°ç¤¾æœƒæŠ•è³‡å ±é…¬ç‡ (SROI)ã€‚</p>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <div class="space-y-4">
                        <div class="bg-blue-50 p-4 rounded-lg border border-blue-100">
                            <h3 class="font-bold text-blue-900 mb-3 border-b border-blue-200 pb-2">åƒæ•¸è¨­å®š</h3>
                            <div>
                                <label class="form-label">SROI å°ˆæ¡ˆåç¨±</label>
                                <input type="text" id="sroi-project-name" class="form-input" value="ç›ˆæ‰è¨ˆç•« - 2025">
                            </div>
                            <div class="mt-3">
                                <label class="form-label">ç¸½æŠ•å…¥æˆæœ¬ (Input) NT$</label>
                                <input type="number" id="sroi-cost" class="form-input font-mono text-right" value="5000000">
                            </div>
                            <div class="mt-3">
                                <label class="form-label">é ä¼°ç¤¾æœƒæ•ˆç›Š (Outcome) NT$</label>
                                <input type="number" id="sroi-benefit" class="form-input font-mono text-right" value="17000000">
                                <p class="text-xs text-gray-500 mt-1">*åŒ…å«å“¡å·¥ç”Ÿç”¢åŠ›æå‡ã€ç¤¾å€æ¡è³¼ä¹˜æ•¸æ•ˆæ‡‰ç­‰é‡åŒ–åƒ¹å€¼</p>
                            </div>
                        </div>
                    </div>

                    <div class="flex flex-col justify-center items-center bg-gray-50 rounded-lg border border-gray-200 p-6">
                        <div class="text-center">
                            <div class="text-sm text-gray-500 mb-2">ç›®å‰é ä¼° SROI</div>
                            <div class="text-6xl font-extrabold text-blue-600" id="sroi-display">1 : 3.40</div>
                            <div class="text-xs text-gray-400 mt-2">æ¯æŠ•å…¥ 1 å…ƒï¼Œå‰µé€  3.40 å…ƒç¤¾æœƒåƒ¹å€¼</div>
                        </div>
                        <button class="btn btn-blue mt-8 px-8 process-btn" data-type="sroi">
                            <i class="fas fa-sync-alt mr-2"></i> åŸ·è¡Œ SVI æ¨™æº–é©—è­‰
                        </button>
                    </div>
                </div>

                <div class="mt-6">
                    <div class="progress-container" id="sroi-progress">
                        <div class="progress-bar bg-blue-600" style="width: 0%"></div>
                    </div>
                    <p class="text-sm text-gray-500 mt-2 hidden log-text" id="sroi-log">å¥—ç”¨ SVI å½±éŸ¿åŠ›åœ°åœ–åƒæ•¸...</p>

                    <div id="sroi-result" class="hidden mt-6 p-6 bg-blue-50 border border-blue-200 rounded-lg animate-fade-in text-center">
                        <i class="fas fa-certificate text-4xl text-blue-500 mb-2"></i>
                        <h3 class="text-xl font-bold text-blue-900">é©—è­‰å®Œæˆ</h3>
                        <p class="text-blue-700">æ­¤ SROI æ•¸å€¼å·²ç¬¦åˆ Ecoshane Bank ä¹‹ã€Œç¤¾æœƒç¸¾æ•ˆåŠ åˆ†æŒ‡æ¨™ã€ã€‚</p>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <!-- é å°¾ -->
    <footer class="mt-8 text-center text-gray-500 text-sm pb-4">
        &copy; 2025 Ecoshane æ°¸çºŒå®¶. All Rights Reserved. (Virtual Project)
    </footer>

    <!-- æ™ºæ…§å®¢æœ Chatbot -->
    <div id="chatbot-container">
        <button id="chat-toggle">
            <i class="fas fa-robot"></i>
        </button>
        <div id="chat-window">
            <div id="chat-header">
                <h3>æ™ºæ…§å°è¦½å®¢æœ</h3>
                <button onclick="toggleChat(false)" class="text-white hover:text-gray-200">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div id="chat-messages">
                <div class="message bot">
                    æ‚¨å¥½ï¼æˆ‘æ˜¯æ‚¨çš„ AI åˆ†æåŠ©ç†ã€‚
                    <br>æƒ³äº†è§£å¦‚ä½•ä½¿ç”¨æœ¬å¹³å°å—ï¼Ÿè«‹é»æ“Šä¸‹æ–¹æŒ‰éˆ•ï¼š
                    <div class="quick-replies">
                        <button class="quick-btn" onclick="sendQuick('ğŸ’° å¦‚ä½•è¨ˆç®— SROIï¼Ÿ')">ğŸ’° SROI æ•™å­¸</button>
                        <button class="quick-btn" onclick="sendQuick('ğŸ›¡ï¸ å¦‚ä½•é©—è­‰ HRDD é¢¨éšªï¼Ÿ')">ğŸ›¡ï¸ HRDD é©—è­‰</button>
                        <button class="quick-btn" onclick="sendQuick('ğŸ“‰ SLL åˆ©ç‡å¦‚ä½•æ¸›ç¢¼ï¼Ÿ')">ğŸ“‰ åˆ©ç‡æ¸›ç¢¼</button>
                    </div>
                </div>
            </div>
            <div id="chat-input-container">
                <input type="text" id="chat-input" placeholder="è¼¸å…¥å•é¡Œ...">
                <button id="chat-send"><i class="fas fa-paper-plane"></i></button>
            </div>
        </div>
    </div>

    <script>
        // --- æ ¸å¿ƒé‚è¼¯ ---
        let riskCount = 0; // å…¨å±€è®Šæ•¸
        let currentClientId = 'yingying'; // è¿½è¹¤ç•¶å‰å®¢æˆ¶

        // 1. å®Œæ•´çš„å®¢æˆ¶æ•¸æ“š (æ–°å¢ SLL é‹ç®—çµæœè¨­å®š)
        const clientData = {
            'yingying': { 
                name: 'ç›ˆç›ˆæ°´æ³¥é›†åœ˜', 
                industry: 'å»ºæè£½é€ ',
                cost: 5000000, 
                benefit: 17000000, 
                project: 'ç›ˆæ‰è¨ˆç•« - 2025',
                // Dashboard Metrics
                riskScore: 25, 
                riskLevel: 'low',
                riskChange: '-33.8%',
                riskDesc: 'é¢¨éšªæ”¹å–„é¡¯è‘—ï¼ŒæŒçºŒç›£æ¸¬ä¸­ã€‚',
                redFlags: 0,
                envScore: 92,
                envChange: '+1.5%',
                sroiRatio: '1:3.4',
                sroiChange: '+0.3',
                // SLL Result (Environment Section)
                sll: {
                    status: 'success',
                    title: 'âœ… ç¬¦åˆæ¨™æº–ï¼šåˆ©ç‡æ¸›ç¢¼ -15bps',
                    icon: 'fas fa-check-circle',
                    color: 'green',
                    reduction: '-15',
                    msg: 'ç’°å¢ƒæ‰¿è«¾ç©©å®šå…Œç¾ï¼Œä¸”ç„¡é‡å¤§ HRDD é¢¨éšªã€‚'
                },
                // Files (Simulation)
                files: {
                    iso: 'ç›ˆç›ˆæ°´æ³¥_2024_ISO14064_æŸ¥è­‰å ±å‘Š.pdf',
                    power: 'å°é›»_2024_å¹´åº¦ç”¨é›»æ˜ç´°.csv'
                },
                // HRDD Risks
                risks: [
                    { id: 'risk-y1', title: 'æ“šå‚³å·¥å» æ’æ”¾å»¢æ°´å°è‡´è¾²ç”°æ±¡æŸ“', source: 'åŒ¿åè«–å£‡ â€¢ 5å°æ™‚å‰', desc: 'ç¶²å‹çˆ†æ–™æŒ‡å‡ºï¼ŒæŸæ°´æ³¥å» å€å¤œé–“å·æ’å»¢æ°´ã€‚ç„¡å…·é«”è­‰æ“šã€‚', cred: 'ä½ (30%)', type: 'low' },
                    { id: 'risk-y2', title: 'é«˜é›„å» å€é·¹æ¶å€’å¡Œæ„å¤–', source: 'XX æ—¥å ± â€¢ 1å¤©å‰', desc: 'æ˜¨æ—¥ä¸‹åˆç™¼ç”Ÿå·¥å®‰æ„å¤–ï¼Œé€ æˆå…©åå·¥äººè¼•å‚·ã€‚', cred: 'é«˜ (90%)', type: 'high' }
                ],
                chartData: [100, 120, 140, 160, 175] // Low Risk trend
            },
            'grandwheel': { 
                name: 'å®è¼ªè‡ªè¡Œè»Šé›†åœ˜', 
                industry: 'è£½é€ æ¥­',
                cost: 8500000, 
                benefit: 21000000, 
                project: 'é›¶æ‹›è˜è²»è¿”é‚„è¨ˆç•«',
                // Dashboard Metrics
                riskScore: 78,
                riskLevel: 'high',
                riskChange: '+15.2%',
                riskDesc: 'å— WRO å½±éŸ¿ï¼Œé¢¨éšªæŒ‡æ•¸é£†å‡ã€‚',
                redFlags: 2,
                envScore: 88,
                envChange: '-0.5%',
                sroiRatio: '1:2.5',
                sroiChange: '+0.1',
                // SLL Result (Environment Section) - FAILURE
                sll: {
                    status: 'fail',
                    title: 'âŒ æœªç¬¦åˆæ¨™æº–ï¼šHRDD é¢¨éšªéé«˜',
                    icon: 'fas fa-times-circle',
                    color: 'red',
                    reduction: '0',
                    msg: 'é›–ç’°å¢ƒç¸¾æ•ˆé”æ¨™ï¼Œä½†å›  WRO æš«æ‰£ä»¤é¢¨éšªï¼ŒSLL å„ªæƒ æš«åœæ ¸ç™¼ã€‚'
                },
                files: {
                    iso: 'å®è¼ªé›†åœ˜_2024_GHG_Inventory.pdf',
                    power: 'GrandWheel_Power_Usage_2024.xlsx'
                },
                // HRDD Risks
                risks: [
                    { id: 'risk-g1', title: 'ç¾åœ‹ CBP ç™¼å¸ƒæš«æ‰£ä»¤ (WRO)', source: 'è·¯é€ç¤¾ (Reuters) â€¢ 3å°æ™‚å‰', desc: 'æŒ‡æ§ä¾›æ‡‰éˆæ¶‰åŠç§»å·¥ã€Œå‚µå‹™æŸç¸›ã€ï¼Œè¦æ±‚å®è¼ªèªªæ˜æ‹›è˜è²»çµæ§‹ã€‚', cred: 'æ¥µé«˜ (99%)', type: 'high' },
                    { id: 'risk-g2', title: 'ç§»å·¥å®¿èˆç’°å¢ƒé­æŠ•è¨´', source: 'ç•¶åœ° NGO â€¢ 1é€±å‰', desc: 'æŒ‡ç¨±å®¿èˆæ“æ“ ä¸”é™åˆ¶å‡ºå…¥ï¼Œä¸ç¬¦åˆ RBA æ¨™æº–ã€‚', cred: 'ä¸­é«˜ (75%)', type: 'high' }
                ],
                chartData: [120, 100, 80, 60, 44] // High Risk trend
            },
            'tech_a': { 
                name: 'å…‰è¯é›»å­ (Tech A)', 
                industry: 'é›»å­æ¥­',
                cost: 12000000, 
                benefit: 30000000, 
                project: 'ä¾›æ‡‰éˆç¶ èƒ½è½‰å‹',
                // Dashboard Metrics
                riskScore: 65,
                riskLevel: 'med',
                riskChange: '-5.0%',
                riskDesc: 'æ—ºå­£å·¥æ™‚åé«˜ï¼Œéœ€æ³¨æ„éå‹é¢¨éšªã€‚',
                redFlags: 1,
                envScore: 95,
                envChange: '+2.0%',
                sroiRatio: '1:2.8',
                sroiChange: '+0.2',
                // SLL Result (Environment Section) - WARNING
                sll: {
                    status: 'warning',
                    title: 'âš ï¸ è§€å¯Ÿåå–®ï¼šåˆ©ç‡ç¶­æŒä¸è®Š',
                    icon: 'fas fa-exclamation-circle',
                    color: 'yellow',
                    reduction: '0',
                    msg: 'ç’°å¢ƒç¸¾æ•ˆå„ªç•°ï¼Œä½†éœ€å…ˆæ”¹å–„å‹å·¥å·¥æ™‚å•é¡Œå§‹èƒ½å•Ÿç”¨å„ªæƒ ã€‚'
                },
                files: {
                    iso: 'TechA_ISO14064_Verification.pdf',
                    power: 'TechA_GreenPower_Cert.pdf'
                },
                // HRDD Risks
                risks: [
                    { id: 'risk-t1', title: 'ä¾›æ‡‰éˆç–‘ä¼¼ä½¿ç”¨è¡çªç¤¦ç”¢', source: 'åœ‹éš›ç‰¹èµ¦çµ„ç¹” â€¢ 2å¤©å‰', desc: 'å ±å‘ŠæŒ‡å‡ºéƒ¨åˆ†åŸæ–™å¯èƒ½ä¾†è‡ªå‰›æœè¡çªå€åŸŸã€‚', cred: 'é«˜ (80%)', type: 'high' },
                    { id: 'risk-t2', title: 'æ—ºå­£åš´é‡è¶…æ™‚åŠ ç­', source: 'å“¡å·¥çˆ†æ–™ â€¢ 3å°æ™‚å‰', desc: 'ç”¢ç·šå“¡å·¥æŒ‡æ§é€£çºŒä¸Šç­ 14 å¤©æœªä¼‘å‡ã€‚', cred: 'ä¸­ (60%)', type: 'medium' }
                ],
                chartData: [60, 60, 64, 68, 70] // Medium Risk trend
            }
        };

        // 2. åˆå§‹åŒ–èˆ‡äº‹ä»¶ç›£è½
        document.addEventListener('DOMContentLoaded', () => {
            const clientSelect = document.getElementById('client-select');
            
            // åˆå§‹åŒ–è¼‰å…¥
            currentClientId = clientSelect.value;
            updateAllData(currentClientId);

            // å®¢æˆ¶åˆ‡æ›äº‹ä»¶
            clientSelect.addEventListener('change', function() {
                currentClientId = this.value;
                updateAllData(currentClientId);
            });
        });

        // 3. æ ¸å¿ƒæ›´æ–°å‡½æ•¸ (Dashboard + Modules)
        function updateAllData(clientId) {
            const data = clientData[clientId];
            if (!data) return;

            // --- A. æ›´æ–°å„€è¡¨æ¿ (Dashboard) ---
            document.getElementById('dash-risk-score').innerHTML = `${data.riskScore}<span class="text-lg font-semibold text-gray-400">/100</span>`;
            
            // é¢¨éšªé¡è‰²å‹•æ…‹è®ŠåŒ–
            const riskValue = document.getElementById('dash-risk-score');
            const riskChange = document.getElementById('dash-risk-change');
            
            if (data.riskLevel === 'high') {
                riskValue.className = 'kpi-value text-red-600';
                riskChange.className = 'kpi-change text-negative';
            } else if (data.riskLevel === 'med') {
                riskValue.className = 'kpi-value text-yellow-600';
                riskChange.className = 'kpi-change text-warning';
            } else {
                riskValue.className = 'kpi-value text-green-600'; // ä½é¢¨éšªç”¨ç¶ è‰²è¡¨ç¤ºå®‰å…¨
                riskChange.className = 'kpi-change text-positive';
            }

            document.getElementById('dash-risk-change').innerText = data.riskChange;
            document.getElementById('dash-risk-desc').innerText = data.riskDesc;
            document.getElementById('dash-red-flags').innerHTML = `${data.redFlags} <span class="text-lg font-semibold text-gray-400">ä»¶</span>`;
            document.getElementById('dash-env-score').innerHTML = `${data.envScore}<span class="text-lg font-semibold text-gray-400">%</span>`;
            document.getElementById('dash-env-change').innerText = data.envChange;
            document.getElementById('dash-sroi-ratio').innerText = data.sroiRatio;
            document.getElementById('dash-sroi-change').innerText = data.sroiChange;

            // ç¹ªè£½ SVG åœ–è¡¨
            renderChart(data.chartData, data.riskLevel);

            // æ›´æ–°å„€è¡¨æ¿è­¦ç¤ºåˆ—è¡¨ (å‰ 2 æ¢)
            const alertList = document.getElementById('dashboard-alerts');
            alertList.innerHTML = '';
            data.risks.forEach(risk => {
                const riskClass = risk.type === 'high' ? 'high-risk' : risk.type === 'medium' ? 'medium-risk' : 'low-risk';
                const icon = risk.type === 'high' ? '<i class="fas fa-exclamation-triangle text-red-600"></i>' : 
                             risk.type === 'medium' ? '<i class="fas fa-exclamation-circle text-amber-600"></i>' : '<i class="fas fa-info-circle text-green-600"></i>';
                
                const div = document.createElement('div');
                div.className = `alert-card ${riskClass}`;
                div.innerHTML = `
                    <div class="alert-icon bg-white shadow-sm">${icon}</div>
                    <div class="alert-content">
                        <h4>${risk.title}</h4>
                        <p>${risk.desc}</p>
                        <div class="alert-meta">
                            <span><i class="far fa-clock"></i> ${risk.source}</span>
                        </div>
                    </div>
                `;
                div.onclick = () => switchToHRDD(); // é»æ“Šè·³è½‰
                alertList.appendChild(div);
            });

            // æ›´æ–°æŠ•è³‡çµ„åˆè¡¨æ ¼ (Highlight ç•¶å‰å®¢æˆ¶)
            renderPortfolioTable(clientId);

            // --- B. æ›´æ–°å„æ¨¡çµ„æ•¸æ“š ---
            
            // 1. ç’°å¢ƒ (E): è‡ªå‹•æ¨¡æ“¬ä¸Šå‚³
            simulateFileUpload('file-group-iso', data.files.iso);
            simulateFileUpload('file-group-power', data.files.power);
            
            // éš±è—ä¹‹å‰çš„é‹ç®—çµæœï¼Œå¼·è¿«ä½¿ç”¨è€…é‡æ–°é»æ“Šé‹ç®—
            document.getElementById('env-result').className = 'hidden mt-6 p-6 rounded-lg animate-fade-in border';

            // 2. SROI
            document.getElementById('sroi-project-name').value = data.project;
            const costInput = document.getElementById('sroi-cost');
            const benefitInput = document.getElementById('sroi-benefit');
            costInput.value = data.cost;
            benefitInput.value = data.benefit;
            updateSroi(); // è§¸ç™¼è¨ˆç®—

            // 3. HRDD æ–°è
            renderRisks(clientId);
        }

        // 4. SVG Chart Renderer
        function renderChart(dataPoints, riskLevel) {
            const svgWidth = 600;
            const svgHeight = 200; // Plot area height
            const stepX = svgWidth / (dataPoints.length - 1);
            
            // é¡è‰²è¨­å®š
            let color = riskLevel === 'high' ? '#b91c1c' : riskLevel === 'med' ? '#f59e0b' : '#059669';

            // ç”Ÿæˆ Path D
            let pathD = `M 0 ${dataPoints[0]}`;
            let areaD = `M 0 250 L 0 ${dataPoints[0]}`; // Start from bottom left

            dataPoints.forEach((y, index) => {
                if (index === 0) return;
                const x = index * stepX;
                pathD += ` L ${x} ${y}`;
                areaD += ` L ${x} ${y}`;
            });

            areaD += ` L ${svgWidth} 250 Z`; // Close area at bottom right

            // æ›´æ–° DOM
            const linePath = document.getElementById('chart-line');
            const areaPath = document.getElementById('chart-area');
            const dotsGroup = document.getElementById('chart-dots');

            linePath.setAttribute('d', pathD);
            linePath.style.stroke = color;

            areaPath.setAttribute('d', areaD);
            areaPath.style.fill = color; 

            // æ›´æ–°é»
            dotsGroup.innerHTML = '';
            dataPoints.forEach((y, index) => {
                const x = index * stepX;
                const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                circle.setAttribute('cx', x);
                circle.setAttribute('cy', y);
                circle.setAttribute('class', 'chart-dot');
                circle.style.stroke = color;
                const title = document.createElementNS('http://www.w3.org/2000/svg', 'title');
                title.textContent = `Score: ${Math.round(100 - (y/2))}`; 
                circle.appendChild(title);
                dotsGroup.appendChild(circle);
            });
        }

        // 5. æª”æ¡ˆä¸Šå‚³æ¨¡æ“¬
        function simulateFileUpload(elementId, filename) {
            const group = document.getElementById(elementId);
            const input = group.querySelector('input');
            const feedback = group.querySelector('.file-feedback');
            const nameSpan = feedback.querySelector('.filename');

            // Reset first
            group.classList.remove('uploaded');
            feedback.style.display = 'none';
            input.value = '';

            // Simulate "Typing/Uploading" delay
            setTimeout(() => {
                input.value = filename;
                group.classList.add('uploaded');
                nameSpan.textContent = filename;
                feedback.style.display = 'flex';
            }, 500);
        }

        // 6. æ¸²æŸ“è¡¨æ ¼
        function renderPortfolioTable(activeId) {
            const tbody = document.getElementById('portfolio-table');
            tbody.innerHTML = '';
            
            Object.keys(clientData).forEach(key => {
                const c = clientData[key];
                const isActive = key === activeId;
                const riskBadgeClass = c.riskLevel === 'high' ? 'high' : c.riskLevel === 'med' ? 'med' : 'low';
                const riskText = c.riskLevel === 'high' ? 'é«˜' : c.riskLevel === 'med' ? 'ä¸­' : 'ä½';
                
                const tr = document.createElement('tr');
                if (isActive) tr.className = "bg-blue-50 border-l-4 border-l-blue-600";
                
                tr.innerHTML = `
                    <td class="font-bold text-gray-900">${c.name}</td>
                    <td>${c.industry}</td>
                    <td><span class="risk-badge ${riskBadgeClass}">${c.riskScore} (${riskText})</span></td>
                    <td class="text-green-600 font-semibold">${c.envScore}%</td>
                    <td>${c.sroiRatio}</td>
                    <td class="text-xs font-bold text-gray-500">æ­£å¸¸å±¥ç´„</td>
                `;
                tbody.appendChild(tr);
            });
        }

        // 7. é é¢è·³è½‰é‚è¼¯
        function switchToHRDD() {
            const hrddBtn = document.querySelector('.tab-button[data-tab="hrdd"]');
            if(hrddBtn) hrddBtn.click();
        }

        // 8. é¢¨éšªæ–°èæ¸²æŸ“ (HRDD Tab)
        function renderRisks(clientId) {
            const list = document.getElementById('risk-list');
            const data = clientData[clientId].risks;
            list.innerHTML = ''; 

            data.forEach(risk => {
                let badgeClass = risk.type === 'high' ? 'text-red-600 bg-red-50' : 
                                 risk.type === 'medium' ? 'text-yellow-600 bg-yellow-50' : 'text-gray-600 bg-gray-100';
                
                const html = `
                    <div class="signal-card" id="${risk.id}">
                        <div class="flex justify-between items-start">
                            <div>
                                <div class="text-xs text-gray-500 font-bold mb-1">ä¾†æºï¼š${risk.source}</div>
                                <h4 class="font-bold text-gray-800 text-lg">${risk.title}</h4>
                                <p class="text-sm text-gray-600 mt-1">${risk.desc}</p>
                                <span class="inline-block mt-2 text-xs font-bold px-2 py-1 rounded ${badgeClass}">AI åˆ¤æ–·ï¼š${risk.cred}</span>
                            </div>
                            <div class="flex flex-col gap-2 ml-4">
                                <button class="btn btn-danger py-1 px-3 text-sm verify-btn" onclick="verifyRisk('${risk.id}', true)">
                                    <i class="fas fa-check mr-1"></i> ç¢ºèª
                                </button>
                                <button class="bg-gray-200 text-gray-600 py-1 px-3 rounded text-sm hover:bg-gray-300 transition" onclick="verifyRisk('${risk.id}', false)">
                                    <i class="fas fa-times mr-1"></i> æ’é™¤
                                </button>
                            </div>
                        </div>
                    </div>
                `;
                list.innerHTML += html;
            });
            
            // é‡ç½® HRDD åˆ†æ•¸é¡¯ç¤º
            const scoreDisplay = document.getElementById('risk-score-display');
            scoreDisplay.textContent = "å¾…é©—è­‰";
            scoreDisplay.className = "text-3xl font-bold text-gray-400";
            riskCount = 0;
        }

        // 9. Tab åˆ‡æ›é‚è¼¯
        const tabs = document.querySelectorAll('.tab-button');
        const contents = document.querySelectorAll('.content-card');

        tabs.forEach(tab => {
            tab.addEventListener('click', () => {
                tabs.forEach(t => t.classList.remove('active'));
                tab.classList.add('active');
                
                const targetId = tab.dataset.tab + '-content';
                contents.forEach(content => {
                    if (content.id === targetId) {
                        content.classList.add('active');
                    } else {
                        content.classList.remove('active');
                    }
                });
            });
        });

        // 10. SROI è¨ˆç®—
        function updateSroi() {
            const costInput = document.getElementById('sroi-cost');
            const benefitInput = document.getElementById('sroi-benefit');
            const sroiDisplay = document.getElementById('sroi-display');
            
            const c = parseFloat(costInput.value) || 1;
            const b = parseFloat(benefitInput.value) || 0;
            const ratio = (b / c).toFixed(2);
            sroiDisplay.textContent = `1 : ${ratio}`;
        }
        
        document.getElementById('sroi-cost').addEventListener('input', updateSroi);
        document.getElementById('sroi-benefit').addEventListener('input', updateSroi);

        // 11. HRDD é©—è­‰æŒ‰éˆ•
        window.verifyRisk = function(elementId, isTrue) {
            const card = document.getElementById(elementId);
            const scoreDisplay = document.getElementById('risk-score-display');
            
            if (isTrue) {
                card.classList.add('verified');
                card.classList.remove('dismissed');
                riskCount++;
            } else {
                card.classList.add('dismissed');
                card.classList.remove('verified');
                if (riskCount > 0 && card.classList.contains('verified')) riskCount--;
            }
            
            if (riskCount > 0) {
                scoreDisplay.textContent = "é«˜é¢¨éšª";
                scoreDisplay.className = "text-3xl font-bold text-red-600";
            } else {
                scoreDisplay.textContent = "ä½é¢¨éšª";
                scoreDisplay.className = "text-3xl font-bold text-green-600";
            }
            
            const btns = card.querySelectorAll('button');
            btns.forEach(b => b.disabled = true);
        };

        // 12. æ¨¡æ“¬é‹ç®—æµç¨‹ (åŒ…å«å·®ç•°åŒ– SLL çµæœ)
        document.querySelectorAll('.process-btn').forEach(btn => {
            btn.addEventListener('click', function() {
                const type = this.dataset.type;
                const progressContainer = document.getElementById(`${type}-progress`);
                const progressBar = progressContainer.querySelector('.progress-bar');
                const logText = document.getElementById(`${type}-log`);
                const resultDiv = document.getElementById(`${type}-result`);

                this.disabled = true;
                this.innerHTML = '<i class="fas fa-circle-notch fa-spin mr-2"></i> AI é‹ç®—ä¸­...';
                progressContainer.style.display = 'block';
                logText.style.display = 'block';
                resultDiv.classList.add('hidden');
                progressBar.style.width = '0%';

                let width = 0;
                const logs = {
                    'env': ['æ­£åœ¨è§£æ PDF...', 'æå–ç¢³æ’ä¿‚æ•¸...', 'æ¯”å° SBTi ç›®æ¨™...', 'å®Œæˆ'],
                    'hrdd': ['æƒæè¼¿æƒ…è³‡æ–™åº«...', 'é—œè¯åˆ†æé¢¨éšªè¨Šè™Ÿ...', 'ç”Ÿæˆé¢¨éšªçŸ©é™£...', 'å®Œæˆ'],
                    'sroi': ['è®€å–è²¡å‹™åƒæ•¸...', 'å¥—ç”¨ SVI å½±éŸ¿åŠ›åœ°åœ–...', 'è¨ˆç®—æŠ˜ç¾ç‡...', 'å®Œæˆ']
                };
                const currentLogs = logs[type];

                const interval = setInterval(() => {
                    width += Math.floor(Math.random() * 10) + 5;
                    if (width > 100) width = 100;
                    progressBar.style.width = width + '%';

                    if (width < 30) logText.textContent = currentLogs[0];
                    else if (width < 60) logText.textContent = currentLogs[1];
                    else if (width < 90) logText.textContent = currentLogs[2];
                    else logText.textContent = currentLogs[3];

                    if (width === 100) {
                        clearInterval(interval);
                        setTimeout(() => {
                            this.disabled = false;
                            this.innerHTML = type === 'env' ? '<i class="fas fa-calculator mr-2"></i> é‡æ–°é‹ç®—' : 
                                             type === 'hrdd' ? '<i class="fas fa-file-contract mr-2"></i> é‡æ–°ç”Ÿæˆå ±å‘Š' :
                                             '<i class="fas fa-sync-alt mr-2"></i> é‡æ–°é©—è­‰';
                            resultDiv.classList.remove('hidden');
                            
                            if (type === 'hrdd') document.getElementById('verified-count').textContent = riskCount;
                            
                            // *** é—œéµä¿®æ”¹ï¼šå·®ç•°åŒ– SLL çµæœ ***
                            if (type === 'env') {
                                const sllData = clientData[currentClientId].sll;
                                const borderColor = sllData.color === 'green' ? 'border-green-200' : sllData.color === 'red' ? 'border-red-200' : 'border-yellow-200';
                                const bgColor = sllData.color === 'green' ? 'bg-green-50' : sllData.color === 'red' ? 'bg-red-50' : 'bg-yellow-50';
                                const textColor = sllData.color === 'green' ? 'text-green-800' : sllData.color === 'red' ? 'text-red-800' : 'text-yellow-800';
                                const iconColor = sllData.color === 'green' ? 'text-green-600' : sllData.color === 'red' ? 'text-red-600' : 'text-yellow-600';
                                
                                resultDiv.className = `hidden mt-6 p-6 ${bgColor} border ${borderColor} rounded-lg animate-fade-in`;
                                resultDiv.innerHTML = `
                                    <div class="flex items-center mb-4">
                                        <i class="${sllData.icon} text-3xl ${iconColor} mr-3"></i>
                                        <h3 class="text-xl font-bold ${textColor}">${sllData.title}</h3>
                                    </div>
                                    <div class="grid grid-cols-1 md:grid-cols-3 gap-4 text-center">
                                        <div class="bg-white p-4 rounded shadow-sm">
                                            <div class="text-sm text-gray-500">ç¢³æ’å¼·åº¦é™å¹…</div>
                                            <div class="text-2xl font-bold text-green-600">-6.2%</div>
                                            <div class="text-xs text-green-700 bg-green-100 px-2 py-1 rounded inline-block mt-1">ç›®æ¨™: -5.0%</div>
                                        </div>
                                        <div class="bg-white p-4 rounded shadow-sm">
                                            <div class="text-sm text-gray-500">å†ç”Ÿèƒ½æºä½”æ¯”</div>
                                            <div class="text-2xl font-bold text-green-600">12.5%</div>
                                            <div class="text-xs text-green-700 bg-green-100 px-2 py-1 rounded inline-block mt-1">ç›®æ¨™: 10.0%</div>
                                        </div>
                                        <div class="bg-white p-4 rounded shadow-sm border-2 ${sllData.color === 'green' ? 'border-green-500' : 'border-gray-200'}">
                                            <div class="text-sm text-gray-500">æ ¸å®šåˆ©ç‡æ¸›ç¢¼</div>
                                            <div class="text-3xl font-bold ${iconColor}">${sllData.reduction} <span class="text-sm">bps</span></div>
                                        </div>
                                    </div>
                                    <p class="text-sm text-gray-600 mt-4 text-center border-t border-gray-200 pt-3">
                                        <i class="fas fa-info-circle mr-1"></i> AI å¯©æ ¸æ„è¦‹ï¼š${sllData.msg}
                                    </p>
                                `;
                                
                                // ç§»é™¤ hidden é¡åˆ¥ä»¥é¡¯ç¤º
                                resultDiv.classList.remove('hidden');
                            }
                        }, 500);
                    }
                }, 150);
            });
        });

        // 13. æ™ºæ…§å®¢æœ
        const chatToggle = document.getElementById('chat-toggle');
        const chatWindow = document.getElementById('chat-window');
        const chatMessages = document.getElementById('chat-messages');
        const chatInput = document.getElementById('chat-input');
        const chatSend = document.getElementById('chat-send');

        window.toggleChat = function(show) {
            if (show) {
                chatWindow.classList.add('show');
            } else {
                chatWindow.classList.remove('show');
            }
        };

        chatToggle.addEventListener('click', () => toggleChat(true));

        function addChatMsg(text, sender) {
            const div = document.createElement('div');
            div.className = `message ${sender}`;
            div.innerHTML = text;
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        window.sendQuick = function(text) {
            addChatMsg(text, 'user');
            setTimeout(() => botReply(text), 600);
        };

        function botReply(text) {
            let reply = "æŠ±æ­‰ï¼Œè«‹æ‚¨å†èªªä¸€æ¬¡ï¼Ÿ";
            if (text.includes("SROI")) {
                reply = "<b>SROI è¨ˆç®—æ•™å­¸ï¼š</b><br>1. é»æ“Šä¸Šæ–¹çš„ã€ŒSROI åƒ¹å€¼ã€æ¨™ç±¤ã€‚<br>2. è¼¸å…¥æ‚¨çš„å°ˆæ¡ˆæˆæœ¬èˆ‡é ä¼°æ•ˆç›Šã€‚<br>3. é»æ“Šã€ŒåŸ·è¡Œé©—è­‰ã€ï¼Œç³»çµ±å°‡ä¾æ“š SVI æ¨™æº–ç”¢å‡ºæ¯”ç‡ã€‚";
            } else if (text.includes("HRDD") || text.includes("é¢¨éšª") || text.includes("é©—è­‰")) {
                reply = "<b>HRDD é©—è­‰æ­¥é©Ÿï¼š</b><br>1. é€²å…¥ã€ŒHRDD é¢¨éšªã€é é¢ã€‚<br>2. æª¢è¦– AI æŠ“å–çš„æ–°èå¡ç‰‡ã€‚<br>3. è‹¥æ–°èå±¬å¯¦ï¼Œé»æ“Šã€Œç¢ºèªã€ï¼›è‹¥ç‚ºå‡æ¶ˆæ¯ï¼Œé»æ“Šã€Œæ’é™¤ã€ã€‚<br>4. ç³»çµ±æœƒè‡ªå‹•è¨ˆç®—æœ€çµ‚é¢¨éšªç­‰ç´šã€‚";
            } else if (text.includes("åˆ©ç‡") || text.includes("SLL")) {
                reply = "<b>SLL åˆ©ç‡æ¸›ç¢¼æ©Ÿåˆ¶ï¼š</b><br>ç•¶æ‚¨çš„ã€Œç’°å¢ƒ SPTsã€é”æ¨™ä¸”ã€ŒHRDD é¢¨éšªã€ç¶­æŒä½é¢¨éšªæ™‚ï¼Œç³»çµ±æœƒè‡ªå‹•æ ¸å®šåˆ©ç‡å„ªæƒ ï¼ˆä¾‹å¦‚ -15 bpsï¼‰ã€‚";
            }
            addChatMsg(reply, 'bot');
        }

        chatSend.addEventListener('click', () => {
            const val = chatInput.value.trim();
            if (val) sendQuick(val);
            chatInput.value = "";
        });
        chatInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') chatSend.click();
        });

    </script>
</body>
</html>
